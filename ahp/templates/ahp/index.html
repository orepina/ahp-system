<html ng-app="app">
<head lang="en">
    {% load staticfiles %}
    <script src="{% static 'ahp/lib/jquery-2.1.3.js' %}"></script>
    <script src="{% static 'ahp/lib/jquery-ui-1.11.4/jquery-ui.js' %}"></script>
    <link rel="stylesheet" href="{% static 'ahp/lib/jquery-ui-1.11.4/jquery-ui.css' %}">
    <link rel="stylesheet" href="{% static 'ahp/lib/jquery-ui-1.11.4/jquery-ui.structure.css' %}">
    <link rel="stylesheet" href="{% static 'ahp/lib/jquery-ui-1.11.4/jquery-ui.theme.css' %}">
    <script src="{% static 'ahp/lib/angular.js' %}"></script>

    <script src="{% static 'ahp/js/components.js' %}"></script>
    <script src="{% static 'ahp/js/checklist-model.js' %}"></script>
    <script src="{% static 'ahp/js/slider.js' %}"></script>
    <script src="{% static 'ahp/js/controllers.js' %}"></script>
    <script src="{% static 'ahp/js/directives.js' %}"></script>
    <script src="{% static 'ahp/js/services.js' %}"></script>
    <script src="{% static 'ahp/js/app.js' %}"></script>

    <script src="{% static 'ahp/bootstrap/js/bootstrap-dropdown.js' %}"></script>
    <link rel="stylesheet" href="{% static 'ahp/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'ahp/css/app_style.css' %}">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <script src="{% static 'ahp/lib/d3.v3.min.js' %}"></script>
    <script src="http://cpettitt.github.io/project/dagre-d3/v0.3.0/dagre-d3.js"></script>

</head>

{% verbatim angular %}
<body ng-controller="tabController">

<div class="menu-block">
<ul class="nav nav-pills nav-stacked" ng-init="settab='1'" >

    <li role="presentation" ng-click="settab='0'" ng-class="{active:settab=='0'}"><a href="#">О программе</a></li>
    <li role="presentation" ng-click="settab='1'; tab.initHierarchy()" ng-class="{active:settab=='1'}"><a href="#">Иерарахия</a></li>
    <li role="presentation" ng-click="settab='2'; tab.initGroups()" ng-class="{active:settab=='2'}"><a href="#">Группы экспертов</a></li>
    <li role="presentation" ng-click="settab='3'; tab.initGroupHierarchyVotes()" ng-class="{active:settab=='3'}"><a href="#">Опросы</a></li>
    <li role="presentation" ng-click="settab='4'; tab.initGlobalPriority()" ng-class="{active:settab=='4'}"><a href="#">Расчет приоритетов</a></li>

</ul>
</div>



<div class="background-block">
<div ng-show="settab=='1'" class="hierarchy">
    <div class="container" ng-controller="hierarchyController" ng-init="init()">
        <popup></popup>
        <!--<hierarchygraph ></hierarchygraph>-->
        <div class="row work-block">
            <div class="title-block">
                Цель
            </div>
            <h3>&nbsp;&nbsp;&nbsp;
                {{node_hash[level_nodes_list[level_order[0]][0]].name}}
                <button ng-click="editGoal(level_nodes_list[level_order[0]][0], level_order[0])" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
            </h3>
            <br><br>
        </div>

        <div class="double">
            <div class="work-block">
                <div class="title-block">
                    Критерии
                </div>
                <div class="crit-block" >
                    <div ng-repeat="level in level_order" ng-if="$index > 1" class="level-block">
                        <div class="small-title">
                            {{level_hash[level].name}}
                            <button ng-click="editLevel(level)" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
                            <button ng-click="deletLevel(level)" class="btn btn-item"><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                        <div  ng-repeat="(node_key, node) in level_nodes_list[level]" class="list-group-item">
                            {{node_hash[node].name}}
                            <button ng-click="editNode(level, node, 'level')" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
                            <button ng-click="deletNode(level, node, 'level')" class="btn btn-item"><span class="glyphicon glyphicon-remove"></span></button>
                        </div>
                        <button ng-click="addNode(level, 'level')" class="btn btn-new"><span class="glyphicon glyphicon-plus">новый критерий</span></button>
                    </div>
                    <button ng-click="addLevel()" class="btn btn-new"><span class="glyphicon glyphicon-plus">новый уровень</span></button>
                </div>
            </div>

            <div class="alt-block work-block">
                <div class="title-block">
                    Альтернативы
                </div>
                <div  ng-repeat="(node_key, node) in level_nodes_list[level_order[1]]" class="list-group-item">
                    {{node_hash[node].name}}
                    <button ng-click="editNode(level_order[1], node)" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
                    <button ng-click="deletNode(level_order[1], node)" class="btn btn-item"><span class="glyphicon glyphicon-remove"></span></button>
                </div>
                <button ng-click="addNode(level_order[1])" class="btn btn-new"><span class="glyphicon glyphicon-plus">новая альтернатива</span></button>
            </div>
            <button ng-click="graphics='graph'" class="btn btn-graph btn-default">Просмотр иерархии</button>
        </div>
    </div>
</div>


<div ng-show="settab=='2'">
    <div ng-controller="groupsController" class="container work-block">
        <popup></popup>
        <div class="row">
            <div class="title-block" >
                Группы
            </div>
        </div>
        <div class="row">
            <div>
                <div ng-repeat="(group_id, group) in group_hash" class="level-block">
                    <div class="small-title">
                        {{group.name}}
                        <span class="user-status">
                        статус голосования
                        </span>
                        <button ng-click="editGroup(group_id)" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
                        <button ng-click="deletGroup(group_id)" class="btn btn-item"><span class="glyphicon glyphicon-remove"></span></button>
                        <button ng-click="settingsGroup(group_id)" class="btn btn-item">---</button>
                    </div>
                    <div>
                        <div ng-repeat="user in user_list | filter: {group: group_id}" class="list-group-item">
                            {{user.name}}
                            {{user.email}}

                            <button ng-click="editUser(user, group_id)" class="btn btn-item"><span class="glyphicon glyphicon-pencil"></span></button>
                            <button ng-click="deletUser(user, group_id)" class="btn btn-item"><span class="glyphicon glyphicon-remove"></span></button>

                            <span class="user-status">
                                <span ng-show="group.count['for_hierarchy'] > 0">
                                    <button ng-show="user.hierarchy_form == ''" ng-click="sendEmailHierarchy(user, group_id)" class="btn btn-primary"><span class="glyphicon glyphicon-envelope"></span></button>
                                    <span ng-show="user.hierarchy_form == 'email'" class="label label-info"><span class="glyphicon glyphicon-time"></span></span>
                                    <button ng-show="user.hierarchy_form == 'check'" class="btn btn-success" ng-click="showUserAnswerHierarchy(user)"><span class="glyphicon glyphicon-ok"></span></button>

                                <span ng ng-show="group.count['for_comparison'] > 0">
                                        <button ng-show="user.comparison_form == ''" ng-click="sendEmailComparison(user, group_id)" class="btn btn-primary"><span class="glyphicon glyphicon-envelope"></span></button>
                                        <span ng-show="user.comparison_form == 'email'" class="label label-info"><span class="glyphicon glyphicon-time"></span></span>
                                        <button ng-show="user.comparison_form == 'check'" class="btn btn-success" ng-click="showUserAnswerComparison(user)"><span class="glyphicon glyphicon-ok"></span></button>

                                </span>
                                <span ng ng-hide="group.count['for_comparison'] > 0" class="label label-danger">
                                    <span class="glyphicon glyphicon-envelope"></span>
                                    настройки г2
                                </span>
                            </span>
                            <span ng-hide="group.count['for_hierarchy'] > 0" class="label label-danger">
                                <span class="glyphicon glyphicon-envelope"></span>
                                настройки г1
                            </span>
                            </span>

                        </div>
                    </div>
                    <button ng-click="addUser(group_id)" class="btn btn-new"><span class="glyphicon glyphicon-plus">новый эксперт</span></button>
                </div>
                <button ng-click="addGroup()" class="btn btn-new"><span class="glyphicon glyphicon-plus">новая группа</span></button>
            </div>
        </div>
    </div>
</div>


<div ng-show="settab=='3'" >
    <div class="container work-block">
        <div ng-controller="chooseGroupController">
            <ul class="nav nav-pills vote-nav" ng-init="settab='3.1'" >
                <li role="presentation" ng-click="settab='3.1'" ng-class="{active:settab=='3.1'}" class="vote-tab"><a href="#">Иерархия</a></li>
                <li role="presentation" ng-click="settab='3.2'" ng-class="{active:settab=='3.2'}" class="vote-tab"><a href="#">Приоритеты</a></li>
            </ul>

            <div class="row">
                <div class="title-block">
                    <span class="h3">
                        Настройки для группы
                    </span>
                    <span class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                            {{group_hash[chosen_group].name}}
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                            <li ng-repeat="(group_key, group) in group_hash" role="presentation">
                                <a role="menuitem" tabindex="-1" href="#" ng-click="chooseGroupNodes(group_key)">
                                    {{group.name}}
                                </a>
                            </li>
                        </ul>
                    </span>
                </div>
            </div>

            <div ng-controller="groupHierarchyController" class="row">
                <popup></popup>
               <!--<hierarchygraphgroups></hierarchygraphgroups>-->
                <div ng-show="settab=='3.1'">
                    <div class="col-md-6">
                        <div class="h3">Критерии:</div>
                        <div class="list-group">
                            <div ng-repeat="level in level_order" ng-if="$index > 1" class="level-block">
                                <div class="small-title">
                                    {{level_hash[level].name}}
                                </div>
                                <div ng-show="level_nodes_list[level].length>0" ng-repeat="(node_key, node) in level_nodes_list[level]" class="list-group-item">
                                    <label>
                                        <input type="checkbox" checklist-model="group_nodes_list[chosen_group]" checklist-value="node" ng-disabled="groups_votes[chosen_group].hierarchy_email>0">
                                        {{node_hash[node].name}}
                                    </label>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="h3">Альтернативы:</div>
                        <div class="list-group level-block">
                            <div ng-repeat="(node_key, node) in level_nodes_list[level_order[1]]" class="list-group-item">
                                <label>
                                <input type="checkbox" checklist-model="group_nodes_list[chosen_group]" checklist-value="node" ng-disabled="groups_votes[chosen_group].hierarchy_email>0">
                                {{node_hash[node].name}}
                                </label>
                            </div>
                        </div>
                    </div>
                    <button ng-click="graphics='graph'" class="btn btn-graph btn-default">Просмотр иерархии</button>
                    <div class="button-group">
                        <button ng-click="save(chosen_group)" class="btn btn-primary" ng-hide="groups_votes[chosen_group].hierarchy_email>0">Сохранить настройки для данной группы</button>
                        <div ng-show="save_nodes=='success'" class="alert alert-success">Настройки успешно сохранены</div>
                        <div ng-show="save_nodes=='error'" class="alert alert-danger">Ошибка при сохранении, повторите позже</div>
                        <div ng-show="groups_votes[chosen_group].hierarchy_email>0" class="alert alert-danger">
                            Вы не можете поменять настройки, так как уже выслали письмо для голосования с такими настройками
                        </div>
                    </div>
                </div>

                <div ng-show="settab=='3.2'">
                    <div ng-controller="groupHierarchyVotesController">
                        <!--<hierarchygraphgroupsvotes></hierarchygraphgroupsvotes>-->
                        <div class="col-md-6">
                            <div class="h3">Критерии:</div>
                            <div class="list-group">
                                <div ng-repeat="level in level_order" ng-if="$index > 1" class="level-block">
                                    <div class="small-title">
                                        {{level_hash[level].name}}
                                    </div>
                                    <div  ng-repeat="(node_key, node) in level_nodes_list[level]" ng-if="isForShow(chosen_group, node)" class="list-group-item">
                                        <label>
                                            <input type="checkbox" checklist-model="group_nodes_for_comparison_list[chosen_group]" checklist-value="node" ng-disabled="groups_votes[chosen_group].comparison_email>0">
                                            {{node_hash[node].name}}
                                            <span class="badge">{{group_nodes_count_list[chosen_group][node].count}}</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="h3">Альтернативы:</div>
                            <div class="list-group level-block">
                                <div ng-repeat="(node_key, node) in level_nodes_list[level_order[1]]" ng-if="isForShow(chosen_group, node)" class="list-group-item">
                                    <label>
                                        <input type="checkbox" checklist-model="group_nodes_for_comparison_list[chosen_group]" checklist-value="node" ng-disabled="groups_votes[chosen_group].comparison_email>0">
                                        {{node_hash[node].name}}
                                        <span class="badge">{{group_nodes_count_list[chosen_group][node].count}}</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <button ng-click="graphics='graph'" class="btn btn-graph btn-default">Просмотр иерархии</button>
                        <div class="button-group">
                            <button ng-click="send(chosen_group)" class="btn btn-primary" ng-hide="groups_votes[chosen_group].comparison_email>0">Сохранить настройки для данной группы</button>
                            <div ng-show="save_nodes_v=='success'" class="alert alert-success">Настройки успешно сохранены</div>
                            <div ng-show="save_nodes_v=='error'" class="alert alert-danger">Ошибка при сохранении, повторите позже</div>
                            <div ng-show="groups_votes[chosen_group].comparison_email>0" class="alert alert-danger">
                                Вы не можете поменять настройки, так как уже выслали письмо для голосования с такими настройками
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>


<div ng-show="settab=='4'">
    <div ng-controller="globalPriorityController" ng-init="init()" class="container priority">
        <popup></popup>
        <div class="double">
            <div class="work-block">
                <div class="title-block">Группы</div>
                <div class="level-block">
                    <div ng-repeat="(group_key, group) in group_hash" class="list-group-item">
                        <div class="active-group">
                            <input type="checkbox" checklist-model="checked_group_list" checklist-value="group_key" ng-disabled="!group.count.for_comparison>0">
                            {{group.name}}
                            <button ng-click="user_settings(group_key)" ng-disabled="!group.count.for_comparison>0" class="btn"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span></button>
                        </div>
                    </div>
                </div>

                <div class="sliders-priority-title">
                    <label>
                    <input type="checkbox" ng-model="show_priority" ng-disabled="checked_group_list.length<2" ng-checked="checked_group_list.length>1 && show_priority">&nbsp;&nbsp; yчитывать приоритеты групп
                    </label>
                </div>
                <div ng-show="show_priority && checked_group_list.length>1" class="level-block">
                    <div ng-repeat="group_key in checked_group_list" class="list-group-item">
                        {{group_hash[group_key].name}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {{group_hash[group_key].priority}} %
                        <div ui-slider="slider.options"  ng-change="change(group_key)" min="0" max="100" ng-model="group_hash[group_key].priority"></div>
                    </div>
                </div>
                <button ng-click="calculate()" ng-show="checked_group_list.length>0" class="btn btn-success btn-block">Расчитать глобальные приоритеты</button>
            </div>

            <div class="work-block">
                <div class="title-block">Альтернативы</div>
                <div class="level-block">
                    <div ng-repeat="(node_key, node) in level_nodes_list[level_order[1]]" class="list-group-item">
                        {{node_hash[node].name}}
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{result[node]*100}}%;">
                                {{Math.round(result[node]*1000)/10}}
                            </div>
                        </div>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    </div>
                </div>
                <button ng-click="calculate()" ng-show="calculated" class="btn btn-success btn-block">Анализ результатов</button>
            </div>

        </div>
    </div>
</div>
</div>
</body>
{% endverbatim angular %}
</html>